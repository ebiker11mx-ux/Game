<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
<title>Mobile Obstacle Course</title>
<style>
  body, html { margin:0; padding:0; width:100%; height:100%; overflow:hidden; }
  canvas { display:block; }
  .controls { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display:flex; gap:10px; }
  .controls button { font-size:18px; padding:10px 15px; border-radius:8px; border:none; background:#3498db; color:white; }
</style>
</head>
<body>

<div class="controls">
  <button id="left">⬅️</button>
  <button id="jump">⬆️</button>
  <button id="right">➡️</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script>
let scene, camera, renderer;
let player, platforms = [];
let velocity = new THREE.Vector3();
let move = { left:false, right:false, jump:false };
let canJump = false;
let gravity = 0.008;
let speed = 0.08;
let jumpPower = 0.18;

init();
animate();

function init() {
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x202033);

  camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.1, 1000);
  camera.position.set(0,6,10);
  camera.lookAt(0,0,0);

  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // Lights
  const light = new THREE.HemisphereLight(0xffffff, 0x444444, 1.2);
  light.position.set(0,20,0);
  scene.add(light);

  // Ground
  const ground = createBox(50,1,50,0x2c3e50);
  ground.position.y = -0.5;
  scene.add(ground);

  // Player
  const playerGeo = new THREE.SphereGeometry(0.5,16,16);
  const playerMat = new THREE.MeshStandardMaterial({color:0xe74c3c});
  player = new THREE.Mesh(playerGeo, playerMat);
  player.position.set(0,0.5,0);
  scene.add(player);

  // Platforms
  for(let i=0; i<6; i++){
    let plat = createBox(3,0.5,3,0x3498db);
    plat.position.set(i*4 - 8, 0.25 + i*1.2, -i*2);
    scene.add(plat);
    platforms.push(plat);
  }

  setupControls();
  window.addEventListener('resize', onResize);
}

function createBox(w,h,d,color){
  const geo = new THREE.BoxGeometry(w,h,d);
  const mat = new THREE.MeshStandardMaterial({color});
  return new THREE.Mesh(geo, mat);
}

function setupControls(){
  const btnLeft = document.getElementById('left');
  const btnRight = document.getElementById('right');
  const btnJump = document.getElementById('jump');

  btnLeft.addEventListener('touchstart', e => move.left = true);
  btnLeft.addEventListener('touchend', e => move.left = false);

  btnRight.addEventListener('touchstart', e => move.right = true);
  btnRight.addEventListener('touchend', e => move.right = false);

  btnJump.addEventListener('touchstart', e => {
    if(canJump){
      velocity.y = jumpPower;
      canJump = false;
    }
  });
}

function onResize(){
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}

function animate(){
  requestAnimationFrame(animate);

  // Gravity
  velocity.y -= gravity;
  player.position.y += velocity.y;

  // Smooth horizontal movement
  if(move.left) player.position.x -= speed;
  if(move.right) player.position.x += speed;

  // Collision with platforms
  let onPlatform = false;
  for(let plat of platforms){
    if(player.position.y - 0.5 <= plat.position.y + 0.25 &&
       player.position.y - 0.5 >= plat.position.y &&
       player.position.x > plat.position.x - 1.5 &&
       player.position.x < plat.position.x + 1.5 &&
       player.position.z > plat.position.z - 1.5 &&
       player.position.z < plat.position.z + 1.5
    ){
      onPlatform = true;
      player.position.y = plat.position.y + 0.5;
      velocity.y = 0;
      canJump = true;
    }
  }

  // Ground collision
  if(player.position.y <= 0.5){
    onPlatform = true;
    player.position.y = 0.5;
    velocity.y = 0;
    canJump = true;
  }

  // Smooth camera follow
  camera.position.lerp(new THREE.Vector3(player.position.x, player.position.y+6, player.position.z+10), 0.1);
  camera.lookAt(player.position);

  renderer.render(scene, camera);
}
</script>
</body>
</html>
