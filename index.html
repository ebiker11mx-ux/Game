<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Glide Tower â€” Working Demo</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">

<style>
html, body {
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  overflow:hidden;
  background:#0b0e18;
  font-family: system-ui, sans-serif;
}
#canvas {
  width:100%;
  height:100%;
  display:block;
  touch-action:none;
}
#controls {
  position:fixed;
  bottom:20px;
  left:20px;
  right:20px;
  display:flex;
  justify-content:space-between;
  pointer-events:none;
}
.stick {
  width:120px;
  height:120px;
  border-radius:50%;
  border:1px solid rgba(255,255,255,.3);
  position:relative;
  pointer-events:auto;
}
.knob {
  width:60px;
  height:60px;
  border-radius:50%;
  background:#3a66ff;
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
}
.btn {
  pointer-events:auto;
  width:120px;
  height:60px;
  border-radius:16px;
  background:#3a66ff;
  color:white;
  font-weight:bold;
  border:none;
}
</style>
</head>

<body>
<canvas id="canvas"></canvas>

<div id="controls">
  <div id="stick" class="stick">
    <div id="knob" class="knob"></div>
  </div>
  <button id="jumpBtn" class="btn">JUMP</button>
</div>

<!-- THREE.JS -->
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>

<script>
(() => {

/* ================= BASIC SETUP ================= */
const canvas = document.getElementById("canvas");
const renderer = new THREE.WebGLRenderer({ canvas, antialias:true });
renderer.setPixelRatio(Math.min(2, window.devicePixelRatio));
renderer.setSize(window.innerWidth, window.innerHeight);

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x0b0e18);

const camera = new THREE.PerspectiveCamera(
  70,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
camera.position.set(0, 6, 14);
camera.lookAt(0, 2, 0);

/* ================= LIGHTS ================= */
scene.add(new THREE.HemisphereLight(0xaec9ff, 0x162040, 1));
const dir = new THREE.DirectionalLight(0xffffff, 0.7);
dir.position.set(5,10,5);
scene.add(dir);

/* ================= PLAYER ================= */
const playerSize = 0.6;
const player = new THREE.Mesh(
  new THREE.BoxGeometry(playerSize,playerSize,playerSize),
  new THREE.MeshStandardMaterial({ color:0xd0e3ff })
);
player.position.set(0,3,0);
scene.add(player);

/* ================= PLATFORM ================= */
const platform = new THREE.Mesh(
  new THREE.BoxGeometry(6,0.4,6),
  new THREE.MeshStandardMaterial({ color:0x3a66ff })
);
platform.position.set(0,1,0);
scene.add(platform);

/* ================= CONTROLS ================= */
const stick = document.getElementById("stick");
const knob = document.getElementById("knob");
const jumpBtn = document.getElementById("jumpBtn");

let stickVec = {x:0,y:0};
let jumpPressed = false;

function clamp(v,min,max){ return Math.max(min,Math.min(max,v)); }

stick.addEventListener("pointermove", e=>{
  if(!e.buttons) return;
  const r = stick.getBoundingClientRect();
  const dx = e.clientX - (r.left + r.width/2);
  const dy = e.clientY - (r.top + r.height/2);
  const max = r.width*0.25;
  const len = Math.hypot(dx,dy);
  const s = len>max ? max/len : 1;
  knob.style.transform = `translate(${dx*s}px,${dy*s}px)`;
  stickVec.x = clamp(dx*s/max,-1,1);
  stickVec.y = clamp(dy*s/max,-1,1);
});

stick.addEventListener("pointerup", ()=>{
  knob.style.transform = "translate(-50%,-50%)";
  stickVec.x = stickVec.y = 0;
});

jumpBtn.onpointerdown = ()=> jumpPressed = true;
jumpBtn.onpointerup   = ()=> jumpPressed = false;

/* ================= PHYSICS ================= */
const vel = new THREE.Vector3();
const GRAVITY = -14;
const MOVE = 7;
const JUMP = 7;
let onGround = false;

/* ================= LOOP ================= */
function animate(){
  requestAnimationFrame(animate);

  vel.x += stickVec.x * MOVE * 0.016;
  vel.z += -stickVec.y * MOVE * 0.016;
  vel.y += GRAVITY * 0.016;

  if(jumpPressed && onGround){
    vel.y = JUMP;
    onGround = false;
  }

  player.position.addScaledVector(vel,0.016);

  // Ground collision
  if(player.position.y - playerSize/2 < platform.position.y + 0.2){
    player.position.y = platform.position.y + 0.2 + playerSize/2;
    vel.y = 0;
    onGround = true;
  }

  camera.position.lerp(
    new THREE.Vector3(
      player.position.x - 5,
      player.position.y + 4,
      player.position.z + 8
    ), 0.1
  );
  camera.lookAt(player.position);

  renderer.render(scene,camera);
}

animate();

/* ================= RESIZE ================= */
window.addEventListener("resize", ()=>{
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth,window.innerHeight);
});

})();
</script>
</body>
</html>
